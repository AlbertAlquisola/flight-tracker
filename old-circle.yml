machine:
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"
  override:
    - env
    - eval `aws ecr get-login --region us-west-2`
    - docker build -t flight-tracker .
    - docker tag flight-tracker 714442741259.dkr.ecr.us-west-2.amazonaws.com/flight-tracker:$CIRCLE_SHA1

test:
  override:
    - echo "no tests! yet."

deployment:
  master:
    branch: master
    commands:
      - docker tag flight-tracker 714442741259.dkr.ecr.us-west-2.amazonaws.com/flight-tracker:production
      - docker push 714442741259.dkr.ecr.us-west-2.amazonaws.com/flight-tracker:production
      - docker push 714442741259.dkr.ecr.us-west-2.amazonaws.com/flight-tracker:$CIRCLE_SHA1

  all:
    branch: /.*?/
    commands:
      - docker push 714442741259.dkr.ecr.us-west-2.amazonaws.com/flight-tracker:$CIRCLE_SHA1
